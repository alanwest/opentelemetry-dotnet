## OpenTelemetry .NET 1.4.0

**OpenTelemetry**

* Use binary search for histograms with 50 or more supplied boundaries. ([#3252](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3252))
* Allows samplers the ability to modify tracestate if desired. ([#3610](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3610))
* Added support for `UpDownCounter` and `ObservableUpDownCounter` instruments. ([#3606](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3606))
* Added support for dependency injection scenarios when configuring `MeterProvider` ([#3646](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3646))
* Revert new logging APIs pending OTel specification changes ([#3702](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3702))

* Make recording of `Min` and `Max` for histograms configurable, enabled by default. ([#2735](https://github.com/open-telemetry/opentelemetry-dotnet/pull/2735))
* Changed default bucket boundaries for Explicit Bucket Histogram from [0, 5, 10, 25, 50, 75, 100, 250, 500, 1000] to [0, 5, 10, 25, 50, 75, 100, 250, 500, 750, 1000, 2500, 5000, 7500, 10000]. ([#3722](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3722))
* Fixed an issue where `LogRecord.ForEachScope` may return scopes from a previous log if accessed in a custom processor before `BatchLogRecordExportProcessor.OnEnd` is fired. ([#3731](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3731))
* Added support for loading environment variables from `IConfiguration` when using `TracerProviderBuilder` or `MeterProviderBuilder` ([#3720](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3720))

* Fix instrument naming enforcement implementation to match the spec. ([#3821](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3821))
* Added support for loading environment variables from `IConfiguration` when using the `MetricReaderOptions` & `BatchExportActivityProcessorOptions` classes. ([#3760](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3760), [#3776](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3776))
* Added dependency injection support in the `ResourceBuilder` class and added support for loading environment variables from `IConfiguration` for the `AddEnvironmentVariableDetector` extension ([#3782](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3782), [#3798](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3798))
* Breaking: MetricPoint API to retrieve Histogram Min, Max changed. The existing pattern of checking if Min/Max is available with `HasMinMax()` and then retrieving the same using `GetHistogramMin()`, `GetHistogramMax()` is replaced with a single API `TryGetHistogramMinMaxValues(out double min, out double max)`. ([#3822](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3822))

* Added dependency injection support in the `ResourceBuilder` class and added support for loading environment variables from `IConfiguration` for the `AddEnvironmentVariableDetector` extension (Logs) ([#3889](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3889))
* Refactored `AddInstrumentation`, `ConfigureServices` and `ConfigureBuilder` APIs into the OpenTelemetry.Extensions.DependencyInjection package and added the `IServiceCollection.AddOpenTelemetry` API ([#3923](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3923))
* Removed `ConfigureResource` on `OpenTelemetryLoggingOptions` ([#3999](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3999))

* Performance Improvement: Update the internal structure used to store metric dimensions from a combination of `string[]` and `object[]` to a `KeyValuePair<string, object>[]`. This results in faster copying of the metric dimensions required for `MetricPoint` lookup on the hot path ([#4059](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4059))

* Removed the dependency on Microsoft.Extensions.Configuration.EnvironmentVariables ([#4092](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4092))
* Removed the explicit reference to Microsoft.Extensions.Options version 5.0 and reverted back to the transitive reference of version 3.1 ([#4093](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4093))
* Added `SetSampler`, `AddProcessor`, & `AddReader` factory extensions. ([#4103](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4103))

* Removed the dependency on System.Reflection.Emit.Lightweight ([#4140](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4140))
* Moved the `AddOpenTelemetry` extension into the `OpenTelemetry.Extensions.Hosting` package so that the `StartWithHost` API could be removed. ([#4174](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4174))

**OpenTelemetry.Api**

* Updated to System.Diagnostics.DiagnosticSource version `7.0.0-rc.1.22426.10`. ([#3698](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3698))

* Updated to System.Diagnostics.DiagnosticSource version `7.0.0-rc.2.22472.3`.

* Updated to System.Diagnostics.DiagnosticSource version `7.0.0`.

**OpenTelemetry.Api.ProviderBuilderExtensions**

* Removed `ConfigureBuilder` from the public API. ([#4103](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4103))
* Renamed package from `OpenTelemetry.Extensions.DependencyInjection` to `OpenTelemetry.Api.ProviderBuilderExtensions`. ([#4125](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4125))

**OpenTelemetry.Exporter.Console**

* Changed the behavior of `ConsoleExporter`, the exporter will stop outputting the data if it is disposed. ([#3578](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3578))
* Added overloads which accept a name to the `MeterProviderBuilder` `AddConsoleExporter` extension to allow for more fine-grained options management ([#3648](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3648))
* Added overloads which accept a name to the `TracerProviderBuilder` `AddConsoleExporter` extension to allow for more fine-grained options management ([#3657](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3657))

* Bumped the minimum required version of `System.Text.Json` to 4.7.2 in response to [CVE-2021-26701](https://github.com/dotnet/runtime/issues/49377). ([#3789](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3789))
* LogRecordExporter to print full exception details instead of just Message, when using `ILogger` to log exception. ([#3784](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3784))
* Added support to print Histogram Min, Max in MetricExporter.

* Bug fix to prevent ConsoleExporter from failing when exporting an `ActivityLink` without Tags. ([#3932](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3932))

**OpenTelemetry.Exporter.InMemory**

* Changed error handling, `InMemoryExporter` will now throw `ObjectDisposedException` if `Export` is invoked after the exporter is disposed. ([#3607](https://github.com/open-telemetry/opentelemetry-dotnet/issues/3607))
* Added overloads which accept a name to the `MeterProviderBuilder` `AddInMemoryExporter` extension to allow for more fine-grained options management ([#3648](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3648))

**OpenTelemetry.Exporter.Jaeger**

* Added overloads which accept a name to the `TracerProviderBuilder` `AddJaegerExporter` extension to allow for more fine-grained options management ([#3656](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3656))

* Added support for loading environment variables from `IConfiguration` when using the `AddJaegerExporter` extension ([#3720](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3720))

* Bumped the minimum required version of `System.Text.Json` to 4.7.2 in response to [CVE-2021-26701](https://github.com/dotnet/runtime/issues/49377). ([#3789](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3789))

**OpenTelemetry.Exporter.OpenTelemetryProtocol**

* Added overloads which accept a name to the `MeterProviderBuilder` `AddOtlpExporter` extension to allow for more fine-grained options management ([#3648](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3648))
* Added overloads which accept a name to the `TracerProviderBuilder` `AddOtlpExporter` extension to allow for more fine-grained options management ([#3653](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3653))

* OTLP histogram data points will now include `Min` and `Max` values when they are present. ([#2735](https://github.com/open-telemetry/opentelemetry-dotnet/pull/2735))
* Adds support for limiting the length and count of attributes exported from the OTLP log exporter. These [Attribute Limits](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/sdk-environment-variables.md#attribute-limits) are configured via the environment variables defined in the specification. ([#3684](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3684))

* Log Exporter modified to no longer prefix scope-depth when exporting ILogger scopes as attributes. Empty keys and {OriginalFormat} key will be ignored from scopes. ([3843](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3843))

* Fix default values for `OTEL_ATTRIBUTE_COUNT_LIMIT`, `OTEL_ATTRIBUTE_COUNT_LIMIT`, `OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT`, `OTEL_SPAN_EVENT_COUNT_LIMIT`, `OTEL_SPAN_LINK_COUNT_LIMIT`, `OTEL_EVENT_ATTRIBUTE_COUNT_LIMIT`, `OTEL_LINK_ATTRIBUTE_COUNT_LIMIT`. All of them are defaulted to `128`. ([#3978](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3978))

* For `AddOtlpExporter` extension methods, configuration delegates will be executed inline and not through Options API when named options are NOT used. ([#4058](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4058))

* Include User-Agent header [per the specification](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md#user-agent). ([#4120](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4120))

* Added a direct dependency on System.Reflection.Emit.Lightweight which previously came transitively through the OpenTelemetry SDK. ([#4140](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4140))

* `AddOtlpExporter` extension methods will now always create a new options instance when named options are NOT used. ([#4200](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4200))

**OpenTelemetry.Exporter.OpenTelemetryProtocol.Logs**

* `OtlpExporterOptions` can now be bound to `IConfiguation` and `HttpClientFactory` may be used to manage the `HttpClient` instance used when `HttpProtobuf` is configured ([#3640](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3640))

**OpenTelemetry.Exporter.Prometheus.AspNetCore**

* Bug fix for Prometheus Exporter reporting StatusCode 204 instead of 200, when no metrics are collected ([#3643](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3643))
* Added overloads which accept a name to the `MeterProviderBuilder` `AddPrometheusExporter` extension to allow for more fine-grained options management ([#3648](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3648))
* Added support for OpenMetrics UNIT metadata ([#3651](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3651))
* Added `"# EOF\n"` ending following the [OpenMetrics specification](https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md) ([#3654](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3654))

* Changed configuration class name from `PrometheusExporterOptions` to `PrometheusAspNetCoreOptions` ([#3717](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3717))

* Support named options in `UseOpenTelemetryPrometheusScrapingEndpoint` & `MapPrometheusScrapingEndpoint` extensions ([#3780](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3780))

**OpenTelemetry.Exporter.Prometheus.HttpListener**

* Bug fix for Prometheus Exporter reporting StatusCode 204 instead of 200, when no metrics are collected ([#3643](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3643))
* Added overloads which accept a name to the `MeterProviderBuilder` `AddPrometheusHttpListener` extension to allow for more fine-grained options management ([#3648](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3648))
* Added support for OpenMetrics UNIT metadata ([#3651](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3651))
* Added `"# EOF\n"` ending following the [OpenMetrics specification](https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md) ([#3654](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3654))

**OpenTelemetry.Exporter.Zipkin**

* Added overloads which accept a name to the `TracerProviderBuilder` `AddZipkinExporter` extension to allow for more fine-grained options management ([#3655](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3655))

* Added support for loading environment variables from `IConfiguration` when using the `AddZipkinExporter` extension ([#3759](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3759))

* Bumped the minimum required version of `System.Text.Json` to 4.7.2 in response to [CVE-2021-26701](https://github.com/dotnet/runtime/issues/49377). ([#3789](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3789))

* Changed EnvironmentVariable parsing to not throw a `FormatException` and instead log a warning. ([#4095](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4095))

**OpenTelemetry.Extensions.Hosting**

* Dependency injection support when configuring `TracerProvider` has been moved into the SDK. ([#3533](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3533))
* Dependency injection support when configuring `MeterProvider` has been moved into the SDK. ([#3646](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3646))

* Added the `OpenTelemetryBuilder.StartWithHost` extension. ([#3923](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3923))

* If the OpenTelemetry SDK cannot start it will now throw exceptions and prevent the host from starting. ([#4006](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4006))

* Added `AddOpenTelemetry` extension from SDK and removed `StartWithHost`. `AddOpenTelemetry` now registers the `IHostedService` used to start collecting traces and/or metrics. ([#4174](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4174))

* Removed deprecated extensions: `AddOpenTelemetryTracing`, `AddOpenTelemetryMetrics`, `Configure`, & `GetServices`. ([#4071](https://github.com/open-telemetry/opentelemetry-dotnet/pull/4071))

**OpenTelemetry.Extensions.Propagators**

## OpenTelemetry .NET non-core packages 1.0.0-rc9.14

**OpenTelemetry.Exporter.ZPages**

**OpenTelemetry.Instrumentation.AspNetCore**

* Performance improvement (Reduced memory allocation) - Updated DiagnosticSource event subscription to specific set of events. ([#3519](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3519))
* Added overloads which accept a name to the `TracerProviderBuilder` `AddAspNetCoreInstrumentation` extension to allow for more fine-grained options management ([#3661](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3661))
* Fix issue where when an application has an ExceptionFilter, the exception data wouldn't be collected. ([#3475](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3475))

* **Breaking change** The `Enrich` callback option has been removed. For better usability, it has been replaced by three separate options: `EnrichWithHttpRequest`, `EnrichWithHttpResponse` and `EnrichWithException`. Previously, the single `Enrich` callback required the consumer to detect which event triggered the callback to be invoked (e.g., request start, response end, or an exception) and then cast the object received to the appropriate type: `HttpRequest`, `HttpResponse`, or `Exception`. The separate callbacks make it clear what event triggers them and there is no longer the need to cast the argument to the expected type. ([#3749](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3749))
* Added back `netstandard2.0` and `netstandard2.1` targets. ([#3755](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3755))

* **Users migrating from version `1.0.0-rc9.9` will see the following breaking changes:**
  * Updated `http.status_code` dimension type from string to int for `http.server.duration` metric. ([#3930](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3930))
  * `http.host` will no longer be populated on `http.server.duration` metric. `net.host.name` and `net.host.port` attributes will be populated instead. ([#3928](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3928))
  * The `http.server.duration` metric's `http.target` attribute is replaced with `http.route` attribute. ([#3903](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3903))
  * `http.host` will no longer be populated on activity. `net.host.name` and `net.host.port` attributes will be populated instead. ([#3858](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3858))
* Extension method `AddAspNetCoreInstrumentation` on `MeterProviderBuilder` now supports `AspNetCoreMetricsInstrumentationOptions`. This option class exposes configuration properties for metric filtering and tag enrichment. ([#3948](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3948), [#3982](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3982))


**OpenTelemetry.Instrumentation.GrpcNetClient**

* Added overloads which accept a name to the `TracerProviderBuilder` `AddGrpcClientInstrumentation` extension to allow for more fine-grained options management ([#3665](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3665))

* **Breaking change** The `Enrich` callback option has been removed. For better usability, it has been replaced by two separate options: `EnrichWithHttpRequestMessage`and `EnrichWithHttpResponseMessage`. Previously, the single `Enrich` callback required the consumer to detect which event triggered the callback to be invoked (e.g., request start or response end) and then cast the object received to the appropriate type: `HttpRequestMessage` and `HttpResponseMessage`. The separate callbacks make it clear what event triggers them and there is no longer the need to cast the argument to the expected type. ([#3804](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3804))

**OpenTelemetry.Instrumentation.Http**

* Dropped `netstandard2.0` target and added `net6.0`. .NET 5 reached EOL in May 2022 and .NET Core 3.1 reaches EOL in December 2022. End of support dates for .NET are published [here](https://dotnet.microsoft.com/download/dotnet). The instrumentation for HttpClient now requires .NET 6 or later. This does not affect applications targeting .NET Framework. ([#3664](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3664))
* Added overloads which accept a name to the `TracerProviderBuilder` `AddHttpClientInstrumentation` extension to allow for more fine-grained options management ([#3664](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3664), [#3667](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3667))

* In case of .NET Core, additional spans created during retries will now be exported. ([[#3729](https://github.com/open-telemetry/opentelemetry-dotnet/issues/3729)])

* Added back `netstandard2.0` target. ([#3787](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3787))
* **Breaking change**: The `Enrich` callback option has been removed. For better usability, it has been replaced by three separate options: In case of `HttpClient` the new options are `EnrichWithHttpRequestMessage`, `EnrichWithHttpResponseMessage` and `EnrichWithException` and in case of `HttpWebRequest` the new options are `EnrichWithHttpWebRequest`, `EnrichWithHttpWebResponse` and `EnrichWithException`. Previously, the single `Enrich` callback required the consumer to detect which event triggered the callback to be invoked (e.g., request start, response end, or an exception) and then cast the object received to the appropriate type: `HttpRequestMessage`, `HttpResponsemessage`, or `Exception` in case of `HttpClient` and `HttpWebRequest`,`HttpWebResponse` and `Exception` in case of `HttpWebRequest`. The separate callbacks make it clear what event triggers them and there is no longer the need to cast the argument to the expected type. ([#3792](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3792))
* Fixed an issue which prevented custom propagators from being called on .NET 7+ runtimes for non-sampled outgoing `HttpClient` spans. ([#3828](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3828))
* **Breaking change**: The same API is now exposed for `net462` and `netstandard2.0` targets. The `Filter` property on options is now exposed as `FilterHttpRequestMessage` (called for .NET & .NET Core) and `FilterHttpWebRequest` (called for .NET Framework). ([#3793](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3793))

* Added `net.peer.name` and `net.peer.port` as dimensions on `http.client.duration` metric. ([#3907](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3907))
* **Breaking change** `http.host` will no longer be populated on activity. `net.peer.name` and `net.peer.port` attributes will be populated instead. ([#3832](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3832))

**OpenTelemetry.Instrumentation.SqlClient**

* Use `Activity.Status` and `Activity.StatusDescription` properties instead of `OpenTelemetry.Trace.Status` and `OpenTelemetry.Trace.Status.Description` respectively to set activity status. ([#3118](https://github.com/open-telemetry/opentelemetry-dotnet/issues/3118)) ([#3751](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3751))

* **Breaking change**: The same API is now exposed for `net462` and `netstandard2.0` targets. `SetDbStatement` has been removed. Use `SetDbStatementForText` to capture command text and stored procedure names on .NET Framework. Note: `Enrich`, `Filter`, `RecordException`, and `SetDbStatementForStoredProcedure` options are NOT supported on .NET Framework. ([#3900](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3900))
* Added overloads which accept a name to the `TracerProviderBuilder` `AddSqlClientInstrumentation` extension to allow for more fine-grained options management ([#3994](https://github.com/open-telemetry/opentelemetry-dotnet/pull/3994))

**OpenTelemetry.Shims.OpenTracing**
