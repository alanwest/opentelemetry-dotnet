<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>netstandard2.0;net461</TargetFrameworks>
    <Description>OpenTelemetry protos for OpenTelemetry .NET</Description>
    <MinVerTagPrefix>proto-</MinVerTagPrefix>

    <ExcludeFromPublicApiAnalyzer>true</ExcludeFromPublicApiAnalyzer>
  </PropertyGroup>

  <PropertyGroup>
    <OpenTelemetryProtoVersion>0.12.0</OpenTelemetryProtoVersion>
    <OpenTelemetryProtoUrl>https://github.com/open-telemetry/opentelemetry-proto/archive/refs/tags/v$(OpenTelemetryProtoVersion).zip</OpenTelemetryProtoUrl>
    <OpenTelemetryProtoZipFile>opentelemetry-proto-$(OpenTelemetryProtoVersion).zip</OpenTelemetryProtoZipFile>
    <OpenTelemetryProtoSourceRoot>opentelemetry-proto</OpenTelemetryProtoSourceRoot>
    <OpenTelemetryProtoSourceDir>$(OpenTelemetryProtoSourceRoot)\opentelemetry-proto-$(OpenTelemetryProtoVersion)</OpenTelemetryProtoSourceDir>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Grpc" Version="$(GrpcPkgVer)" />
    <PackageReference Include="Google.Protobuf" Version="$(GoogleProtobufPkgVer)" />
    <PackageReference Include="Grpc.Tools" Version="$(GrpcToolsPkgVer)" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <Protobuf Include="**/*.proto">
      <ProtoRoot>$(OpenTelemetryProtoSourceDir)</ProtoRoot>
    </Protobuf>
  </ItemGroup>

  <Target Name="DownloadOpenTelemetryProto" BeforeTargets="Build">
    <DownloadFile Condition="!Exists('$(OpenTelemetryProtoZipFile)')"
      SourceUrl="$(OpenTelemetryProtoUrl)"
      DestinationFolder="$(MSBuildProjectDirectory)" />

    <Unzip Condition="!Exists('$(OpenTelemetryProtoSourceDir)')"
      SourceFiles="$(OpenTelemetryProtoZipFile)"
      DestinationFolder="$(OpenTelemetryProtoSourceRoot)"
      OverwriteReadOnlyFiles="true" />

    <Delete Files="opentelemetry-proto-src\opentelemetry-proto-$(OpenTelemetryProtoVersion)\opentelemetry\proto\metrics\experimental\metrics_config_service.proto" />
  </Target>
</Project>
